%html
  %head
    %title Dossier
    = stylesheet_link_tag "application", :media => "all"
    = javascript_include_tag "application"
    %meta{content:"width=device-width", name:"viewport"}
    %meta{name:"apple-mobile-web-app-capable", content:"yes"}
    = csrf_meta_tags

  %body
    = yield


    :javascript
      function getInConnections() {
        IN.API.Connections("me")
          .fields("firstName", "lastName", "picture-urls::(original)", "publicProfileUrl", "headline", "id")
          .result(function(res) {

            console.log(res);

            for (var i=0, numPeeps = res.values.length; i<numPeeps; i++) {

              var peep = res.values[i];
              if (peep.pictureUrls && peep.pictureUrls.values) {

                $aTag = $('<a>').addClass('image-wrapper');

                $('<span>')
                  .addClass('image-text')
                  .addClass('invisible')
                  .html("<h1>" + peep.firstName + " " + peep.lastName + "</h1><br /><h2>" + peep.headline + "</h2>")
                  .appendTo($aTag);

                $('<img>')
                  .attr('src', peep.pictureUrls.values[0])
                  .addClass('attendee')
                  .appendTo($aTag);

                $('.event-container').append($aTag);
              }
            }
          });
      }

      $(function() {

        $('body').on('click', '.linked-sign-in', function(e) {
          e.preventDefault();
          $(this).find("span").last().click();
        });

        $('body').on('click', 'span', function(e) {
          e.stopPropagation();
        });

        $('body').on('click', '.linked-sign-out', function(e) {
          e.preventDefault();
          IN.User.logout();
          $('event-container').fadeOut(1000, function(e) {
            $('event-container').html('');
          });
        });

         window.IN.Event.on(IN, "auth", function(event) {
          $('.linked-sign-in').addClass('hidden');
          $('.linked-sign-out').removeClass('hidden');
         });

        window.IN.Event.on(IN, "logout", function(event) {
          $('.linked-sign-in').removeClass('hidden');
          $('.linked-sign-out').addClass('hidden');
        });

      });



    %script{src:"http://platform.linkedin.com/in.js"}
      api_key: 77m7x30ie4sdmo
      authorize: true
      credentials_cookie: true
      scope: r_fullprofile r_emailaddress r_network rw_groups


    :javascript
      // 2. Runs when the JavaScript framework is loaded
        function onLinkedInLoad() {
          IN.Event.on(IN, "auth", onLinkedInAuth);
      }

      // 2. Runs when the viewer has authenticated
      function onLinkedInAuth() {
        IN.API.Profile("me").result(displayProfiles);
      }

      // 2. Runs when the Profile() API call returns successfully
      function displayProfiles(profiles) {
        member = profiles.values[0];
        document.getElementById("profiles").innerHTML =
        "<p id=\"" + member.id + "\">Hello " +  member.firstName + " " + member.lastName + "</p>";
      }
